<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Media Viewer Demo</title>
  <link rel="stylesheet" href="styles/main.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>Media Viewer</h1>
      <div>
        <a href="about.html" class="about-link">About</a>
        <button id="dark-mode-toggle" class="dark-mode-toggle">Toggle Dark Mode</button>
      </div>
    </header>
    
    <div class="media-viewer-container">
      <div class="sidebar-wrapper">
        <media-sidebar id="media-sidebar"></media-sidebar>
      </div>
      
      <div class="viewer-wrapper">
        <div class="media-container" id="media-container">
          <!-- Pre-defined media components that will be shown/hidden as needed -->
          <video-player id="video-player" style="display: none;">
            <video-controls></video-controls>
          </video-player>
          <image-viewer id="image-viewer" style="display: none;"></image-viewer>
        </div>
      </div>
    </div>
    
    <footer>
      <p>&copy; 2025 Media Viewer</p>
    </footer>
  </div>
  
  <!-- Right-click menu component -->
  <right-click-menu id="right-click-menu" target="#media-container > *"></right-click-menu>
  
  <!-- Shortcut handler component -->
  <shortcut-handler id="shortcut-handler" target="#video-player" skip-forward-seconds="10" skip-backward-seconds="10"></shortcut-handler>
  
  <!-- Load components -->
  <script src="components/media-base/media-base.js"></script>
  <script src="components/video-player/video-player.js"></script>
  <script src="components/video-controls/video-controls.js"></script>
  <script src="components/image-viewer/image-viewer.js"></script>
  <script src="components/media-sidebar/media-sidebar.js"></script>
  <script src="components/right-click-menu/right-click-menu.js"></script>
  <script src="components/shortcut-handler/shortcut-handler.js"></script>
  
  <!-- Load utilities and data -->
  <script src="js/utilities.js"></script>
  <script src="js/media-data.js"></script>
  
  <script>
    // Initialize the application
    document.addEventListener('DOMContentLoaded', () => {
      // Get references to elements
      const mediaSidebar = document.getElementById('media-sidebar');
      const mediaContainer = document.getElementById('media-container');
      const videoPlayer = document.getElementById('video-player');
      const imageViewer = document.getElementById('image-viewer');
      const darkModeToggle = document.getElementById('dark-mode-toggle');
      const rightClickMenu = document.getElementById('right-click-menu');
      const shortcutHandler = document.getElementById('shortcut-handler');
      
      // Initialize dark mode
      const isDarkMode = MediaViewerUtils.initDarkMode();
      
      // Set up dark mode toggle
      darkModeToggle.addEventListener('click', () => {
        const isDarkMode = MediaViewerUtils.toggleDarkMode();
        
        // Update components
        videoPlayer.setAttribute('dark-mode', isDarkMode.toString());
        imageViewer.setAttribute('dark-mode', isDarkMode.toString());
        mediaSidebar.setAttribute('dark-mode', isDarkMode.toString());
        rightClickMenu.setAttribute('dark-mode', isDarkMode.toString());
        shortcutHandler.setAttribute('dark-mode', isDarkMode.toString());
      });
      
      // Set media items to sidebar
      console.log('Setting media items to sidebar:', MediaData.getAllItems().length);
      mediaSidebar.setMediaItems(MediaData.getAllItems());
      
      // Listen for media selection
      mediaSidebar.addEventListener('media-selected', (event) => {
        const mediaItem = event.detail;
        loadMediaItem(mediaItem);
      });
      
      // Set right-click menu target
      rightClickMenu.setAttribute('target', '#media-container > *');
      
      // Load the first media item by default
      const allItems = MediaData.getAllItems();
      if (allItems.length > 0) {
        setTimeout(() => {
          console.log('Setting initial active media item:', allItems[0].id);
          mediaSidebar.setActiveItem(allItems[0].id);
          loadMediaItem(allItems[0]);
        }, 300);
      }
      
      // Function to load a media item
      function loadMediaItem(item) {
        console.log(`Loading media item: ${item.name} (${item.type})`);
        
        // Hide all media components first
        videoPlayer.style.display = 'none';
        imageViewer.style.display = 'none';
        
        if (item.type === 'videos') {
          // Update video player attributes
          videoPlayer.setAttribute('src', item.src);
          
          if (item.format) {
            videoPlayer.setAttribute('format', item.format);
          }
          
          // Set dark mode if active
          if (document.body.classList.contains('dark-mode')) {
            videoPlayer.setAttribute('dark-mode', 'true');
          }
          
          // Show the video player
          videoPlayer.style.display = 'block';
          
          // Update shortcut handler and right-click menu targets
          shortcutHandler.setAttribute('target', '#video-player');
          rightClickMenu.setAttribute('target', '#video-player');
          console.log('Updated targets for video player');
          
        } else if (item.type === 'images') {
          // Update image viewer attributes
          imageViewer.setAttribute('src', item.src);
          
          if (item.alt) {
            imageViewer.setAttribute('alt', item.alt);
          }
          
          // Set dark mode if active
          if (document.body.classList.contains('dark-mode')) {
            imageViewer.setAttribute('dark-mode', 'true');
          }
          
          // Show the image viewer
          imageViewer.style.display = 'block';
          
          // Update shortcut handler and right-click menu targets
          shortcutHandler.setAttribute('target', '#image-viewer');
          rightClickMenu.setAttribute('target', '#image-viewer');
          console.log('Updated targets for image viewer');
        }
        
        // Notify that media has changed
        MediaViewerUtils.notifyMediaChanged(item);
      }
    });
  </script>
</body>
</html> 